<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spendsplit</title>

<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro", sans-serif;
        margin: 0;
        background: #f4f7fb;
    }

    h2 {
        margin: 12px 0;
        font-size: 22px;
        font-weight: 600;
    }

    .tab-bar {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top: 1px solid #d0d0d0;
    }

    .tab {
        flex: 1;
        padding: 12px;
        text-align: center;
        font-size: 15px;
        cursor: pointer;
    }

    .tab.active {
        background: #e0f0ff;
        font-weight: 600;
        border-top: 3px solid #4aa3ff;
    }

    .screen { display: none; padding: 20px; padding-bottom: 90px; }

    .glass {
        background: rgba(255,255,255,0.45);
        backdrop-filter: blur(8px);
        padding: 15px;
        margin-bottom: 12px;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.07);
    }

    .accordion-header {
        font-size: 17px;
        padding: 12px;
        cursor: pointer;
        border-radius: 10px;
        background: #fafafa;
    }

    .accordion-header.active {
        background: #e0f0ff;
        font-weight: 600;
    }

    .accordion-content {
        display: none;
        padding: 12px 8px 4px 8px;
    }

    input, select {
        width: 100%;
        padding: 10px;
        margin: 6px 0;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 15px;
    }

    button {
        padding: 10px 16px;
        border-radius: 10px;
        border: none;
        font-size: 15px;
        cursor: pointer;
        margin-top: 6px;
    }

    .btn {
        background: #4aa3ff;
        color: white;
    }

    .btn.red {
        background: #ff6b6b;
    }

    .entry-item, .people-item, .category-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 5px;
        background: white;
        border-radius: 8px;
        margin: 4px 0;
        cursor: pointer;
    }

    .checkbox-left {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .summary-box {
        background: white;
        padding: 14px;
        border-radius: 12px;
        margin-top: 8px;
        line-height: 1.45;
    }

    .action-row {
        display: flex;
        gap: 8px;
        margin-top: 12px;
    }
</style>
</head>

<body>

<!-- TITLE -->
<div style="text-align:center; padding: 15px 0; font-size: 24px; font-weight: 700;">
    Spendsplit
</div>

<!-- BASE TAB -->
<div id="base" class="screen">
    <div class="glass">
        <div class="accordion-header" onclick="toggleAcc(this, 'groupsAcc')">Groups</div>
        <div id="groupsAcc" class="accordion-content"></div>

        <div class="accordion-header" onclick="toggleAcc(this, 'peopleAcc')">People</div>
        <div id="peopleAcc" class="accordion-content"></div>

        <div class="accordion-header" onclick="toggleAcc(this, 'catAcc')">Categories</div>
        <div id="catAcc" class="accordion-content"></div>
    </div>
</div>

<!-- ENTRIES TAB -->
<div id="entries" class="screen">
    <h2>Add Entry</h2>
    <div class="glass">

        <input id="entryName" placeholder="Entry name">

        <input id="entryAmount" type="number" placeholder="Amount">

        <select id="entryCategory"></select>

        <h3>Participants</h3>
        <div id="participantSelect"></div>

        <button class="btn" onclick="addEntry()">Add Entry</button>
    </div>

    <h2>All Entries</h2>
    <div id="entriesList"></div>
</div>

<!-- SUMMARY TAB -->
<div id="summary" class="screen">
    <h2>Summary</h2>
    <div id="summaryBox" class="summary-box"></div>

    <h3>Transfer To</h3>
    <select id="transferSelect" onchange="updateSummary()"></select>

    <div class="action-row">
        <button class="btn" onclick="copySummary()">Copy</button>
        <button class="btn" onclick="shareSummary()">Share</button>
        <button class="btn red" onclick="resetEntries()">Reset Entries</button>
    </div>
</div>

<!-- TABS -->
<div class="tab-bar">
    <div class="tab active" onclick="showTab('base', this)">Base</div>
    <div class="tab" onclick="showTab('entries', this)">Entries</div>
    <div class="tab" onclick="showTab('summary', this)">Summary</div>
</div>

<script>
/* -----------------------
   DATA STORAGE
----------------------- */

let data = {
    groups: ["Default"],
    activeGroup: "Default",
    people: ["Jack", "Rose"],
    categories: ["Food", "Entertainment", "Fuel", "Shopping"],
    entries: []
};

function save() { localStorage.setItem("spendsplit", JSON.stringify(data)); }
function load() {
    let d = localStorage.getItem("spendsplit");
    if (d) data = JSON.parse(d);
}
load();


/* -----------------------
   UI TAB HANDLING
----------------------- */

function showTab(tab, el) {
    document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
    document.getElementById(tab).style.display = 'block';

    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');

    refreshAll();
}

document.getElementById("base").style.display = "block";


/* -----------------------
   ACCORDIONS
----------------------- */

function toggleAcc(header, id) {
    header.classList.toggle("active");
    let box = document.getElementById(id);
    box.style.display = box.style.display === "block" ? "none" : "block";
}


/* -----------------------
   REFRESH UI
----------------------- */

function refreshAll() {
    load();
    refreshGroups();
    refreshPeople();
    refreshCategories();
    refreshParticipants();
    refreshEntries();
    refreshSummary();
}


/* -----------------------
   GROUPS
----------------------- */

function refreshGroups() {
    let box = document.getElementById("groupsAcc");
    box.innerHTML = `
        <div><b>Active Group:</b> ${data.activeGroup}</div>
        <input id="newGroupName" placeholder="New group">
        <button class="btn" onclick="addGroup()">Add</button>
    `;

    data.groups.forEach(g => {
        box.innerHTML += `
            <div class="people-item">
                <div>${g}</div>
                <div>
                    <button onclick="setGroup('${g}')">Use</button>
                    <button class="btn red" onclick="removeGroup('${g}')">X</button>
                </div>
            </div>
        `;
    });
}

function addGroup() {
    let name = document.getElementById("newGroupName").value.trim();
    if (!name) return;
    data.groups.push(name);
    save(); refreshGroups();
}

function setGroup(g) { data.activeGroup = g; save(); refreshGroups(); refreshEntries(); refreshSummary(); }

function removeGroup(g) {
    data.groups = data.groups.filter(x => x !== g);
    if (data.activeGroup === g) data.activeGroup = data.groups[0] || "Default";
    save(); refreshGroups();
}


/* -----------------------
   PEOPLE
----------------------- */

function refreshPeople() {
    let box = document.getElementById("peopleAcc");
    box.innerHTML = `
        <input id="newPerson" placeholder="New person">
        <button class="btn" onclick="addPerson()">Add</button>
    `;

    data.people.forEach(p => {
        box.innerHTML += `
            <div class="people-item">
                <div>${p}</div>
                <button class="btn red" onclick="removePerson('${p}')">X</button>
            </div>
        `;
    });
}

function addPerson() {
    let n = document.getElementById("newPerson").value.trim();
    if (!n) return;
    data.people.push(n);
    save(); refreshPeople(); refreshParticipants();
}

function removePerson(n) {
    data.people = data.people.filter(x => x !== n);
    save(); refreshPeople(); refreshParticipants();
}


/* -----------------------
   CATEGORIES
----------------------- */

function refreshCategories() {
    let box = document.getElementById("catAcc");

    box.innerHTML = `
        <input id="newCat" placeholder="New category">
        <button class="btn" onclick="addCategory()">Add</button>
    `;

    data.categories.forEach(c => {
        box.innerHTML += `
            <div class="category-item">
                <div>${c}</div>
                <button class="btn red" onclick="removeCategory('${c}')">X</button>
            </div>
        `;
    });

    document.getElementById("entryCategory").innerHTML =
        data.categories.map(c => `<option>${c}</option>`).join("");
}

function addCategory() {
    let c = document.getElementById("newCat").value.trim();
    if (!c) return;
    data.categories.push(c);
    save(); refreshCategories();
}

function removeCategory(c) {
    data.categories = data.categories.filter(x => x !== c);
    save(); refreshCategories();
}


/* -----------------------
   PARTICIPANT SELECTOR
----------------------- */

function refreshParticipants() {
    let box = document.getElementById("participantSelect");
    box.innerHTML = "";
    data.people.forEach(p => {
        let id = "chk_" + p;
        box.innerHTML += `
            <div class="entry-item" onclick="toggleCheck('${id}')">
                <div class="checkbox-left">
                    <input type="checkbox" id="${id}">
                    <span>${p}</span>
                </div>
            </div>
        `;
    });
}

function toggleCheck(id) {
    let c = document.getElementById(id);
    c.checked = !c.checked;
}


/* -----------------------
   ADD ENTRY
----------------------- */

function addEntry() {
    let name = document.getElementById("entryName").value.trim();
    let amt = parseInt(document.getElementById("entryAmount").value);
    let category = document.getElementById("entryCategory").value;

    let ppl = data.people.filter(p => document.getElementById("chk_" + p).checked);

    if (!name || !amt || ppl.length === 0) return;

    data.entries.push({
        group: data.activeGroup,
        name,
        amount: Math.round(amt),
        category,
        people: ppl
    });

    save();
    refreshEntries();
    refreshSummary();
}


/* -----------------------
   ENTRIES DISPLAY
----------------------- */

function refreshEntries() {
    let list = document.getElementById("entriesList");
    list.innerHTML = "";

    data.entries
        .filter(e => e.group === data.activeGroup)
        .forEach((e, i) => {
            list.innerHTML += `
                <div class="entry-item">
                    <div>${e.name} — ₹${e.amount}</div>
                    <button class="btn red" onclick="deleteEntry(${i})">X</button>
                </div>
            `;
        });
}

function deleteEntry(i) {
    data.entries.splice(i, 1);
    save(); refreshEntries(); refreshSummary();
}


/* -----------------------
   SUMMARY + TRANSFER
----------------------- */

function refreshSummary() { updateSummary(); }

function updateSummary() {
    let box = document.getElementById("summaryBox");
    let groupEntries = data.entries.filter(e => e.group === data.activeGroup);

    if (groupEntries.length === 0) {
        box.innerHTML = "No entries.";
        return;
    }

    // per-person
    let totals = {};
    data.people.forEach(p => totals[p] = 0);

    groupEntries.forEach(e => {
        let share = Math.round(e.amount / e.people.length);
        e.people.forEach(p => totals[p] += share);
    });

    // UI
    let html = "<b>Totals:</b><br>";
    data.people.forEach(p => html += `${p}: ₹${totals[p]}<br>`);

    let payer = document.getElementById("transferSelect").value || data.people[0];

    if (!document.getElementById("transferSelect").value) {
        document.getElementById("transferSelect").innerHTML =
            data.people.map(p => `<option>${p}</option>`).join("");
    }

    // transfer logic
    let owes = totals[payer];
    let result = `<br><b>Transfer:</b><br>Everyone pays to ${payer}.<br>`;

    data.people.forEach(p => {
        if (p !== payer && totals[p] > totals[payer]) {
            let diff = totals[p] - totals[payer];
            if (diff > 0) result += `${payer} pays ₹${diff} to ${p}<br>`;
        }
    });

    box.innerHTML = html + result;
}

function copySummary() {
    navigator.clipboard.writeText(document.getElementById("summaryBox").innerText);
}

async function shareSummary() {
    let text = document.getElementById("summaryBox").innerText;
    if (navigator.share) navigator.share({ text });
}

function resetEntries() {
    data.entries = data.entries.filter(e => e.group !== data.activeGroup);
    save();
    refreshEntries();
    refreshSummary();
}

refreshAll();
</script>

</body>
</html>
