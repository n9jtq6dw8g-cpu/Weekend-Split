<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Spendsplit</title>

<style>
    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Inter", sans-serif;
        background: #f2f2f7;
        color: #111;
    }

    /* Liquid Glass Card */
    .card {
        backdrop-filter: blur(14px) saturate(180%);
        -webkit-backdrop-filter: blur(14px) saturate(180%);
        background: rgba(255, 255, 255, 0.55);
        border-radius: 22px;
        padding: 18px;
        margin: 16px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 18px rgba(0,0,0,0.05);
    }

    .title {
        text-align: center;
        padding: 18px 0 2px 0;
        font-size: 26px;
        font-weight: 700;
        backdrop-filter: blur(6px);
    }

    .tabs {
        display: flex;
        margin: 16px;
        gap: 8px;
    }

    .tab {
        flex: 1;
        padding: 12px;
        text-align: center;
        background: white;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.2s;
        font-weight: 500;
        box-shadow: 0 2px 5px rgba(0,0,0,0.06);
    }

    .tab.active {
        background: #007aff;
        color: white;
        font-weight: 600;
    }

    .section {
        display: none;
    }

    .section.active {
        display: block;
        animation: fade 0.25s ease;
    }

    @keyframes fade {
        from { opacity: 0; transform: translateY(6px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .row {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        align-items: center;
    }

    .list-item {
        padding: 10px 0;
        border-bottom: 1px solid #ddd;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .list-item:last-child {
        border-bottom: none;
    }

    button {
        width: 100%;
        padding: 12px;
        margin-top: 8px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        cursor: pointer;
        font-weight: 600;
        background: #007aff;
        color: white;
    }

    button.secondary {
        background: #e5e5ea;
        color: #000;
    }

    .footer-actions {
        display: flex;
        justify-content: space-between;
        gap: 8px;
        margin-top: 16px;
    }

    .footer-actions button {
        flex: 1;
        font-size: 14px;
        padding: 10px;
    }

</style>
</head>

<body>

<div class="title">Spendsplit</div>

<div class="tabs">
    <div class="tab active" onclick="switchTab('groups')">Groups</div>
    <div class="tab" onclick="switchTab('people')">People</div>
    <div class="tab" onclick="switchTab('categories')">Categories</div>
    <div class="tab" onclick="switchTab('entries')">Add Entry</div>
    <div class="tab" onclick="switchTab('summary')">Summary</div>
</div>

<!-- GROUPS -->
<div id="groups" class="section active card">
    <h3>Groups</h3>
    <div id="groupList"></div>
    <input id="newGroup" placeholder="New group name" style="width:100%;padding:10px;margin-top:10px;border-radius:10px;border:1px solid #ccc;">
    <button onclick="addGroup()">Add Group</button>
</div>

<!-- PEOPLE -->
<div id="people" class="section card">
    <h3>People</h3>
    <div id="peopleList"></div>
    <input id="newPerson" placeholder="Person name" style="width:100%;padding:10px;margin-top:10px;border-radius:10px;border:1px solid #ccc;">
    <button onclick="addPerson()">Add Person</button>
</div>

<!-- CATEGORIES -->
<div id="categories" class="section card">
    <h3>Categories</h3>
    <div id="categoryList"></div>
    <input id="newCategory" placeholder="Category name" style="width:100%;padding:10px;margin-top:10px;border-radius:10px;border:1px solid #ccc;">
    <button onclick="addCategory()">Add Category</button>
</div>

<!-- ENTRIES -->
<div id="entries" class="section card">
    <h3>Add Entry</h3>

    <label>Amount</label>
    <input id="amount" type="number" style="width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;">

    <label style="margin-top:10px;">Paid By</label>
    <select id="paidBy" style="width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;"></select>

    <label style="margin-top:10px;">Category</label>
    <select id="entryCategory" style="width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;"></select>

    <h4 style="margin-top:12px;">Participants</h4>
    <div id="participantList"></div>

    <button onclick="addEntry()">Add Entry</button>
</div>

<!-- SUMMARY -->
<div id="summary" class="section card">
    <h3>Summary</h3>
    <div id="summaryContent"></div>

    <label style="margin-top:14px;">Transfer To</label>
    <select id="transferTo" onchange="updateSummary()" style="width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;"></select>

    <div id="finalTransferText" style="margin-top:14px;font-weight:600;"></div>

    <!-- ACTIONS ROW -->
    <div class="footer-actions">
        <button class="secondary" onclick="resetEntries()">Reset Entries</button>
        <button onclick="copySummary()">Copy</button>
        <button onclick="shareSummary()">Share</button>
    </div>

</div>

<script>
/* Local storage state */
let state = { groups: [], people: [], categories: ["Food","Entertainment","Fuel","Shopping"], entries: [], activeGroup: null };

function save(){ localStorage.setItem("spendsplit", JSON.stringify(state)); }
function load(){
    const data = localStorage.getItem("spendsplit");
    if (data) state = JSON.parse(data);
}
load();

/* UI helpers */
function switchTab(id){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById(id).classList.add('active');
    refreshUI();
}

function refreshUI(){
    updateGroups();
    updatePeople();
    updateCategories();
    updateParticipants();
    updateSummary();
}

/* GROUPS */
function addGroup(){
    const name=document.getElementById("newGroup").value.trim();
    if(!name) return;
    state.groups.push(name);
    state.activeGroup=name;
    document.getElementById("newGroup").value="";
    save(); refreshUI();
}

function updateGroups(){
    const div=document.getElementById("groupList");
    div.innerHTML="";
    state.groups.forEach(g=>{
        const row=document.createElement("div");
        row.className="list-item";
        row.innerHTML=`${g}`;
        row.onclick=()=>{ state.activeGroup=g; save(); refreshUI(); };
        div.appendChild(row);
    });
}

/* PEOPLE */
function addPerson(){
    const name=document.getElementById("newPerson").value.trim();
    if(!name) return;
    state.people.push(name);
    document.getElementById("newPerson").value="";
    save(); refreshUI();
}

function updatePeople(){
    const list=document.getElementById("peopleList");
    const paidBy=document.getElementById("paidBy");
    const transfer=document.getElementById("transferTo");

    list.innerHTML="";
    paidBy.innerHTML="";
    transfer.innerHTML="<option value=''>Select</option>";

    state.people.forEach(p=>{
        let row=document.createElement("div");
        row.className="list-item";
        row.innerHTML=p;
        list.appendChild(row);

        paidBy.innerHTML += `<option>${p}</option>`;
        transfer.innerHTML += `<option>${p}</option>`;
    });
}

/* CATEGORIES */
function addCategory(){
    const name=document.getElementById("newCategory").value.trim();
    if(!name) return;
    state.categories.push(name);
    document.getElementById("newCategory").value="";
    save(); refreshUI();
}

function updateCategories(){
    let list=document.getElementById("categoryList");
    let entryCat=document.getElementById("entryCategory");

    list.innerHTML="";
    entryCat.innerHTML="";

    state.categories.forEach(c=>{
        let row=document.createElement("div");
        row.className="list-item";
        row.innerHTML=c;
        list.appendChild(row);

        entryCat.innerHTML += `<option>${c}</option>`;
    });
}

/* PARTICIPANTS */
function updateParticipants(){
    const div=document.getElementById("participantList");
    div.innerHTML="";

    state.people.forEach(p=>{
        let row=document.createElement("div");
        row.className="list-item";
        row.onclick=()=> toggleParticipant(p);

        row.innerHTML = `
            <input type="checkbox" id="chk-${p}" style="transform:scale(1.3);" />
            <span>${p}</span>
        `;

        div.appendChild(row);
    });
}

let tempParticipants = [];

function toggleParticipant(name){
    const idx=tempParticipants.indexOf(name);
    if(idx>=0) tempParticipants.splice(idx,1);
    else tempParticipants.push(name);

    document.getElementById("chk-"+name).checked = tempParticipants.includes(name);
}

/* ADD ENTRY */
function addEntry(){
    const amt=parseInt(document.getElementById("amount").value);
    const paidBy=document.getElementById("paidBy").value;
    const cat=document.getElementById("entryCategory").value;

    if(!amt || !paidBy || tempParticipants.length===0) return;

    state.entries.push({
        amount: amt,
        paidBy,
        participants:[...tempParticipants],
        category:cat
    });

    tempParticipants=[];
    save(); refreshUI();
}

/* SUMMARY */
function updateSummary(){
    const div=document.getElementById("summaryContent");
    div.innerHTML="";

    let totals={}, categoryTotals={};

    state.people.forEach(p=>totals[p]=0);

    state.entries.forEach(e=>{
        e.participants.forEach(p=>{
            totals[p] -= Math.round(e.amount/e.participants.length);
        });
        totals[e.paidBy] += e.amount;

        categoryTotals[e.category]=(categoryTotals[e.category]||0)+e.amount;
    });

    /* Show category totals */
    Object.keys(categoryTotals).forEach(cat=>{
        div.innerHTML += `<b>${cat}:</b> ₹${categoryTotals[cat]}<br>`;
    });

    div.innerHTML += `<hr>`;

    /* Show totals */
    Object.keys(totals).forEach(p=>{
        div.innerHTML += `${p}: <b>${totals[p]}</b><br>`;
    });

    /* Transfer logic */
    const t=document.getElementById("transferTo").value;
    if(!t) return;

    let receivers=[];
    let payerTotal = totals[t];

    Object.keys(totals).forEach(p=>{
        if(p!==t && totals[p]<0){
            receivers.push({ person:p, amt: Math.abs(totals[p]) });
        }
    });

    receivers.sort((a,b)=>b.amt - a.amt);

    let text = `Everyone pays to ${t}.<br>`;
    let left = payerTotal;

    receivers.forEach(r=>{
        if(left<=0) return;
        let pay = Math.min(left, r.amt);
        if(pay>0){
            text += `${t} pays ₹${pay} to ${r.person}.<br>`;
            left -= pay;
        }
    });

    document.getElementById("finalTransferText").innerHTML=text;
}

/* RESET ENTRIES */
function resetEntries(){
    state.entries=[];
    save(); refreshUI();
}

/* COPY SUMMARY */
function copySummary(){
    const text=document.getElementById("summary").innerText;
    navigator.clipboard.writeText(text);
}

/* SHARE SUMMARY (text only for now) */
function shareSummary(){
    const text=document.getElementById("summary").innerText;
    navigator.share({ text });
}

/* Initialize UI */
refreshUI();
</script>

</body>
</html>
