<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Split App</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Inter",sans-serif;background:#fafafa;color:#111;}
header{padding:16px;font-size:22px;font-weight:600;text-align:center;border-bottom:1px solid #ddd;background:#fff;position:sticky;top:0;z-index:10;}
.container{padding:16px;max-width:650px;margin:auto;}
h2{margin-top:28px;font-size:18px;font-weight:600;}
.card{background:#fff;padding:14px;margin-top:12px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.07);}
input,select{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #ccc;font-size:15px;}
button{width:100%;padding:12px;margin-top:12px;border:none;background:#111;color:#fff;border-radius:8px;font-size:15px;cursor:pointer;}
button:active{opacity:.7;}
.list-item{background:#f5f5f5;padding:10px;border-radius:8px;margin-top:8px;display:flex;justify-content:space-between;align-items:center;}
.list-item button{width:auto;background:#e74c3c;padding:6px 10px;font-size:13px;}
.edit-btn{background:#3498db!important;margin-right:8px;}
#summaryBox{margin-top:20px;padding:14px;background:#fff;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.07);}
#shareBtn{background:#111;width:140px;margin-top:14px;border-radius:8px;font-size:14px;padding:10px;display:flex;gap:6px;align-items:center;justify-content:center;}
#shareBtn span{font-size:18px;margin-top:-2px;}
</style>
</head>

<body>
<header>Split App</header>
<div class="container">

<h2>Groups</h2>
<div class="card">
    <input id="newGroupName" placeholder="Enter group name">
    <button onclick="addGroup()">Add Group</button>
    <select id="groupSelect" onchange="switchGroup()"></select>
</div>

<h2>People in Group</h2>
<div class="card">
    <input id="newPersonName" placeholder="Enter person name">
    <button onclick="addPerson()">Add Person</button>
    <div id="peopleList"></div>
</div>

<h2>Categories</h2>
<div class="card">
    <input id="newCategoryName" placeholder="Enter category name">
    <button onclick="addCategory()">Add Category</button>
    <div id="categoryList"></div>
</div>

<h2>Add Expense</h2>
<div class="card">
    <select id="payerSelect"></select>
    <input id="amountInput" type="number" placeholder="Amount">

    <label>Select participants:</label>
    <div id="participantList"></div>

    <select id="categorySelect"></select>
    <button onclick="addExpense()">Add Expense</button>
</div>

<h2>Expenses</h2>
<div id="expenseList"></div>

<h2>Summary</h2>
<div id="summaryBox"></div>

<button id="shareBtn" onclick="shareSummary()"><span>⬆️</span> Share</button>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
// --------------------------------------
// Local Storage
// --------------------------------------
let data = JSON.parse(localStorage.getItem("splitAppData")) || {
    groups: {
        "My Group": {
            people: [],
            categories: ["Food","Entertainment","Fuel","Shopping"],
            expenses: []
        }
    },
    activeGroup: "My Group"
};
function save(){ localStorage.setItem("splitAppData", JSON.stringify(data)); }

// --------------------------------------
// Groups
// --------------------------------------
function refreshGroups(){
    const sel=document.getElementById("groupSelect");
    sel.innerHTML="";
    Object.keys(data.groups).forEach(g=>{
        let op=document.createElement("option");
        op.value=g; op.textContent=g;
        if(g===data.activeGroup) op.selected=true;
        sel.appendChild(op);
    });
    save();
    refreshPeople(); refreshCategories(); refreshExpenses(); updateSummary();
}
function addGroup(){
    let name=document.getElementById("newGroupName").value.trim();
    if(!name) return;
    data.groups[name]={people:[],categories:["Food","Entertainment","Fuel","Shopping"],expenses:[]};
    data.activeGroup=name;
    document.getElementById("newGroupName").value="";
    refreshGroups();
}
function switchGroup(){
    data.activeGroup=document.getElementById("groupSelect").value;
    save(); refreshPeople(); refreshCategories(); refreshExpenses(); updateSummary();
}

// --------------------------------------
// People
// --------------------------------------
function refreshPeople(){
    const list=document.getElementById("peopleList");
    const payerSel=document.getElementById("payerSelect");
    list.innerHTML=""; payerSel.innerHTML="";
    let g=data.groups[data.activeGroup];
    g.people.forEach((p,i)=>{
        let row=document.createElement("div");
        row.className="list-item";
        row.innerHTML=`${p}
        <div>
            <button class="edit-btn" onclick="renamePerson(${i})">Edit</button>
            <button onclick="deletePerson(${i})">X</button>
        </div>`;
        list.appendChild(row);
        let op=document.createElement("option");
        op.value=p; op.textContent=p; payerSel.appendChild(op);
    });
    refreshParticipants(); save();
}
function addPerson(){
    let name=document.getElementById("newPersonName").value.trim();
    if(!name) return;
    data.groups[data.activeGroup].people.push(name);
    document.getElementById("newPersonName").value="";
    refreshPeople();
}
function deletePerson(i){
    data.groups[data.activeGroup].people.splice(i,1);
    refreshPeople();
}
function renamePerson(i){
    let newName=prompt("Enter new name:");
    if(!newName) return;
    data.groups[data.activeGroup].people[i]=newName;
    refreshPeople();
}

// --------------------------------------
// Categories
// --------------------------------------
function refreshCategories(){
    const list=document.getElementById("categoryList");
    const sel=document.getElementById("categorySelect");
    list.innerHTML=""; sel.innerHTML="";
    let g=data.groups[data.activeGroup];
    g.categories.forEach((c,i)=>{
        let row=document.createElement("div");
        row.className="list-item";
        row.innerHTML=`${c} <button onclick="deleteCategory(${i})">X</button>`;
        list.appendChild(row);
        let op=document.createElement("option");
        op.value=c; op.textContent=c; sel.appendChild(op);
    });
    save();
}
function addCategory(){
    let v=document.getElementById("newCategoryName").value.trim();
    if(!v) return;
    data.groups[data.activeGroup].categories.push(v);
    document.getElementById("newCategoryName").value="";
    refreshCategories();
}
function deleteCategory(i){
    data.groups[data.activeGroup].categories.splice(i,1);
    refreshCategories();
}

// --------------------------------------
// Participants
// --------------------------------------
function refreshParticipants(){
    const div=document.getElementById("participantList");
    div.innerHTML="";
    let g=data.groups[data.activeGroup];
    g.people.forEach(p=>{
        let row=document.createElement("div");
        row.innerHTML=`<label><input type="checkbox" value="${p}"> ${p}</label>`;
        div.appendChild(row);
    });
}

// --------------------------------------
// Expenses
// --------------------------------------
function refreshExpenses(){
    const list=document.getElementById("expenseList");
    list.innerHTML="";
    let g=data.groups[data.activeGroup];
    g.expenses.forEach((ex,i)=>{
        let row=document.createElement("div");
        row.className="card";
        row.innerHTML=
        `<b>${ex.payer}</b> paid <b>₹${ex.amount}</b> for ${ex.category}<br>
        Participants: ${ex.participants.join(", ")}<br><br>
        <button class="edit-btn" onclick="editExpense(${i})">Edit</button>
        <button onclick="deleteExpense(${i})">Delete</button>`;
        list.appendChild(row);
    });
}
function addExpense(){
    const payer=document.getElementById("payerSelect").value;
    const amount=Math.round(Number(document.getElementById("amountInput").value));
    const category=document.getElementById("categorySelect").value;
    let parts=[];
    document.querySelectorAll("#participantList input:checked")
        .forEach(c=>parts.push(c.value));
    if(!payer || !amount || parts.length===0) return;
    data.groups[data.activeGroup].expenses.push({payer,amount,participants:parts,category});
    document.getElementById("amountInput").value="";
    refreshExpenses(); updateSummary(); save();
}
function deleteExpense(i){
    data.groups[data.activeGroup].expenses.splice(i,1);
    refreshExpenses(); updateSummary(); save();
}
function editExpense(i){
    let g=data.groups[data.activeGroup];
    let ex=g.expenses[i];
    let newAmount=prompt("Enter new amount:",ex.amount);
    if(!newAmount) return;
    ex.amount=Math.round(Number(newAmount));
    refreshExpenses(); updateSummary(); save();
}

// --------------------------------------
// Summary
// --------------------------------------
function updateSummary(){
    let g=data.groups[data.activeGroup];
    const div=document.getElementById("summaryBox");
    div.innerHTML="";
    let totals={}, bal={};
    g.people.forEach(p=>bal[p]=0);
    g.categories.forEach(c=>totals[c]=0);
    g.expenses.forEach(ex=>{
        totals[ex.category]+=ex.amount;
        let split=Math.round(ex.amount/ex.participants.length);
        ex.participants.forEach(p=>bal[p]-=split);
        bal[ex.payer]+=ex.amount;
    });
    div.innerHTML+="<b>Category Totals:</b><br>";
    g.categories.forEach(c=>div.innerHTML+=`${c}: ₹${totals[c]}<br>`);
    div.innerHTML+="<br><b>Balances:</b><br>";
    Object.keys(bal).forEach(p=>div.innerHTML+=`${p}: ₹${bal[p]}<br>`);
}

// --------------------------------------
// Share as image
// --------------------------------------
function shareSummary(){
    const sum=document.getElementById("summaryBox");
    html2canvas(sum).then(canvas=>{
        canvas.toBlob(blob=>{
            const file=new File([blob],"summary.png",{type:"image/png"});
            if(navigator.share){
                navigator.share({title:"Split Summary",files:[file]});
            }else alert("Sharing not supported here.");
        });
    });
}

// Init
refreshGroups();
</script>
</body>
</html>
